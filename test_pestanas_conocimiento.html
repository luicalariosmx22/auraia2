<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧪 Test - Sistema de Pestañas</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { border-color: #4CAF50; background: #f8fff8; }
        .error { border-color: #f44336; background: #fff8f8; }
        .warning { border-color: #ff9800; background: #fffdf8; }
        .info { border-color: #2196F3; background: #f8f9ff; }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #005a8a; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .highlight { background: yellow; }
        
        /* Estilos para las pestañas de prueba */
        .tab-button {
            padding: 8px 16px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-right: 10px;
        }
        .tab-button.active {
            border-bottom-color: #14b8a6;
            color: #14b8a6;
            background: #f0fdfa;
        }
        .tab-content {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
        }
        .hidden { display: none; }
        #log-container {
            max-height: 400px;
            overflow-y: auto;
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Test - Sistema de Pestañas del Panel de Conocimiento</h1>
        <p><strong>Objetivo:</strong> Diagnosticar y probar el sistema de pestañas</p>
        
        <div class="test-section info">
            <h3>📋 Instrucciones:</h3>
            <ol>
                <li>Este test simula las pestañas del panel de conocimiento</li>
                <li>Usa los botones de abajo para probar la funcionalidad</li>
                <li>Revisa la consola para diagnósticos detallados</li>
                <li>Los logs aparecerán en el área de abajo</li>
            </ol>
        </div>
    </div>

    <div class="container">
        <h2>🎯 Pestañas de Prueba</h2>
        
        <!-- Simulación de pestañas -->
        <div class="mb-6">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8">
                    <button class="tab-button active" data-tab="ver-conocimiento">
                        👁️ Ver Conocimiento
                    </button>
                    <button class="tab-button" data-tab="agregar-conocimiento">
                        ➕ Agregar Nuevo
                    </button>
                    <button class="tab-button" data-tab="gestionar-etiquetas">
                        🏷️ Gestionar Etiquetas
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenidos de pestañas -->
        <div id="tab-ver-conocimiento" class="tab-content">
            <h3>👁️ Ver Conocimiento</h3>
            <p>Esta es la pestaña de visualización del conocimiento.</p>
            <p>Aquí se mostrarían todos los bloques de conocimiento existentes.</p>
        </div>

        <div id="tab-agregar-conocimiento" class="tab-content hidden">
            <h3>➕ Agregar Nuevo</h3>
            <p>Esta es la pestaña para agregar nuevo conocimiento.</p>
            <p>Aquí estaría el formulario para crear nuevos bloques.</p>
            <form>
                <textarea placeholder="Contenido del conocimiento..." rows="3" style="width:100%; margin:10px 0;"></textarea>
                <input type="text" placeholder="Etiquetas separadas por comas" style="width:100%; margin:10px 0;">
                <button type="button">Agregar Conocimiento</button>
            </form>
        </div>

        <div id="tab-gestionar-etiquetas" class="tab-content hidden">
            <h3>🏷️ Gestionar Etiquetas</h3>
            <p>Esta es la pestaña para gestionar etiquetas.</p>
            <p>Aquí se mostrarían estadísticas y gestión de etiquetas.</p>
        </div>
    </div>

    <div class="container">
        <h2>🔧 Controles de Prueba</h2>
        <button onclick="ejecutarDiagnostico()">🔍 Ejecutar Diagnóstico</button>
        <button onclick="probarPestaña('ver-conocimiento')">👁️ Probar Ver</button>
        <button onclick="probarPestaña('agregar-conocimiento')">➕ Probar Agregar</button>
        <button onclick="probarPestaña('gestionar-etiquetas')">🏷️ Probar Gestionar</button>
        <button onclick="reinicializarPestañas()">🔄 Reinicializar</button>
        <button onclick="limpiarLog()">🧹 Limpiar Log</button>
    </div>

    <div class="container">
        <h2>📊 Log en Tiempo Real</h2>
        <div id="log-container"></div>
    </div>

    <div class="container">
        <h2>📝 Código para Consola del Panel Real</h2>
        <p>Copia este código en la consola del panel de entrenamiento:</p>
        <pre id="codigo-panel"></pre>
        <button onclick="copiarCodigo()">📋 Copiar Código</button>
    </div>

    <!-- Cargar los scripts necesarios -->
    <script>
        // Código de diagnóstico integrado
        let logContainer;
        
        function log(mensaje) {
            if (!logContainer) {
                logContainer = document.getElementById('log-container');
            }
            const timestamp = new Date().toLocaleTimeString();
            logContainer.innerHTML += `[${timestamp}] ${mensaje}\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(mensaje);
        }
        
        function limpiarLog() {
            if (logContainer) {
                logContainer.innerHTML = '';
            }
        }

        // Estado global simplificado
        window.PANEL_STATE = {
            currentTab: 'ver-conocimiento',
            initialized: false
        };

        // Función switchTab simplificada
        function switchTab(targetTab, tabButtons, tabContents) {
            log(`🎯 Cambiando a pestaña: ${targetTab}`);
            
            if (!tabButtons) tabButtons = document.querySelectorAll('.tab-button');
            if (!tabContents) tabContents = document.querySelectorAll('.tab-content');
            
            // Desactivar todos los botones
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activar botón objetivo
            const activeButton = document.querySelector(`[data-tab="${targetTab}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
                log(`✅ Botón activado: ${targetTab}`);
            } else {
                log(`❌ Botón no encontrado: ${targetTab}`);
            }

            // Ocultar todos los contenidos
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            // Mostrar contenido objetivo
            const targetContent = document.getElementById('tab-' + targetTab);
            if (targetContent) {
                targetContent.classList.remove('hidden');
                log(`✅ Contenido mostrado: tab-${targetTab}`);
            } else {
                log(`❌ Contenido no encontrado: tab-${targetTab}`);
            }
            
            window.PANEL_STATE.currentTab = targetTab;
            return true;
        }

        // Función initializeTabs
        function initializeTabs() {
            log('🔄 Inicializando sistema de pestañas...');
            
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            log(`   - Botones encontrados: ${tabButtons.length}`);
            log(`   - Contenidos encontrados: ${tabContents.length}`);

            tabButtons.forEach((button, index) => {
                const targetTab = button.getAttribute('data-tab');
                log(`   - Configurando botón ${index + 1}: ${targetTab}`);
                
                // Remover eventos anteriores
                button.onclick = null;
                
                // Agregar nuevo evento
                button.addEventListener('click', () => {
                    log(`🖱️ Clic en pestaña: ${targetTab}`);
                    switchTab(targetTab, tabButtons, tabContents);
                });
            });
            
            window.PANEL_STATE.initialized = true;
            log('✅ Sistema de pestañas inicializado');
        }

        // Funciones de prueba
        function ejecutarDiagnostico() {
            log('🧪 INICIANDO DIAGNÓSTICO COMPLETO...');
            log('============================================');

            // Verificar elementos
            const elementos = {
                'botones pestañas': document.querySelectorAll('.tab-button'),
                'contenidos': document.querySelectorAll('.tab-content'),
                'ver-conocimiento botón': document.querySelector('[data-tab="ver-conocimiento"]'),
                'agregar-conocimiento botón': document.querySelector('[data-tab="agregar-conocimiento"]'),
                'gestionar-etiquetas botón': document.querySelector('[data-tab="gestionar-etiquetas"]'),
                'tab-ver-conocimiento': document.getElementById('tab-ver-conocimiento'),
                'tab-agregar-conocimiento': document.getElementById('tab-agregar-conocimiento'),
                'tab-gestionar-etiquetas': document.getElementById('tab-gestionar-etiquetas')
            };

            Object.entries(elementos).forEach(([nombre, elemento]) => {
                if (elemento && elemento.length !== undefined) {
                    log(`   ✅ ${nombre}: ${elemento.length} elementos`);
                } else {
                    const existe = elemento !== null;
                    log(`   ${existe ? '✅' : '❌'} ${nombre}: ${existe ? 'Encontrado' : 'NO ENCONTRADO'}`);
                }
            });

            log('============================================');
        }

        function probarPestaña(nombrePestaña) {
            log(`\n🧪 PROBANDO PESTAÑA: ${nombrePestaña}`);
            const resultado = switchTab(nombrePestaña);
            if (resultado) {
                log(`✅ Pestaña ${nombrePestaña} cambiada exitosamente`);
            } else {
                log(`❌ Error cambiando a pestaña ${nombrePestaña}`);
            }
        }

        function reinicializarPestañas() {
            log('\n🔄 REINICIALIZANDO...');
            initializeTabs();
        }

        // Código para el panel real
        const codigoPanelReal = `
// 🧪 DIAGNÓSTICO PESTAÑAS PANEL REAL
console.log('🧪 INICIANDO DIAGNÓSTICO EN PANEL REAL...');

// Verificar elementos del DOM
const botonesPestañas = document.querySelectorAll('.tab-button');
const contenidosPestañas = document.querySelectorAll('.tab-content');

console.log('Botones encontrados:', botonesPestañas.length);
console.log('Contenidos encontrados:', contenidosPestañas.length);

// Verificar funciones
console.log('switchTab disponible:', typeof window.switchTab);
console.log('initializeTabs disponible:', typeof window.initializeTabs);

// Reinicializar sistema
if (typeof window.initializeTabs === 'function') {
    window.initializeTabs();
    console.log('✅ Sistema reinicializado');
} else {
    console.log('❌ initializeTabs no disponible');
}

// Probar cambio a "Agregar Nuevo"
setTimeout(() => {
    if (typeof window.switchTab === 'function') {
        window.switchTab('agregar-conocimiento', botonesPestañas, contenidosPestañas);
        console.log('✅ Intentando cambiar a agregar-conocimiento');
    } else {
        console.log('❌ switchTab no disponible');
    }
}, 1000);

// Funciones de prueba
window.probarAgregar = () => {
    const botones = document.querySelectorAll('.tab-button');
    const contenidos = document.querySelectorAll('.tab-content');
    window.switchTab('agregar-conocimiento', botones, contenidos);
};

console.log('💡 Ejecuta: probarAgregar()');
        `;

        document.getElementById('codigo-panel').textContent = codigoPanelReal.trim();

        function copiarCodigo() {
            navigator.clipboard.writeText(document.getElementById('codigo-panel').textContent).then(() => {
                log('📋 Código copiado al portapapeles');
            });
        }

        // Exportar funciones globalmente
        window.switchTab = switchTab;
        window.initializeTabs = initializeTabs;
        window.probarPestaña = probarPestaña;
        window.reinicializarPestañas = reinicializarPestañas;
        window.ejecutarDiagnostico = ejecutarDiagnostico;

        // Auto-inicialización
        document.addEventListener('DOMContentLoaded', () => {
            log('📚 Página cargada, inicializando...');
            initializeTabs();
            
            // Auto-diagnóstico después de un momento
            setTimeout(ejecutarDiagnostico, 500);
        });
    </script>
</body>
</html>
