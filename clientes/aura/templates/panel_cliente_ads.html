<!-- Archivo: clientes/aura/templates/panel_cliente_ads.html -->

{% extends "base_cliente.html" %}
{% block contenido %}
  <h1 class="text-2xl font-bold text-blue-800 mb-6 flex items-center gap-2">
    <span class="inline-block bg-blue-100 text-blue-700 rounded-full px-3 py-1 text-lg">Meta Ads</span>
    <span class="text-gray-500 font-normal text-lg">para {{ nombre_nora|capitalize }}</span>
  </h1>

  <!-- Cuentas Publicitarias -->
  <section class="module">
    <h2>📢 Cuentas Publicitarias</h2>
    {% if cuentas_ads %}
    <table class="tabla-contactos">
      <thead>
        <tr>
          <th>Cliente</th>
          <th>Estado</th>
          <th>Campañas Activas</th>
          <th>Anuncios Activos</th>
          <th>Gasto (7 días)</th>
          <th>Acción</th>
        </tr>
      </thead>
      <tbody>
        {% for cuenta in cuentas_ads %}
        <tr>
          <td>{{ cuenta.nombre_cliente }}</td>
          <td>
            {% if cuenta.account_status == 1 %}
              🟢 Activa
            {% elif cuenta.account_status == 2 %}
              🟡 Pausada
            {% elif cuenta.account_status == 3 %}
              🔴 Cerrada/Inhabilitada
            {% elif cuenta.account_status == 7 %}
              ⚠️ En Revisión
            {% else %}
              ❓ ({{ cuenta.account_status }})
            {% endif %}
          </td>
          <td>{{ cuenta.campanas_activas if cuenta.campanas_activas else '—' }}</td>
          <td>{{ cuenta.anuncios_activos if cuenta.anuncios_activos else '—' }}</td>
          <td>
            {{ cuenta.gasto_7dias if cuenta.gasto_7dias else '—' }} {{ moneda }}
          </td>
          <td>
            <a href="{{ url_for('panel_cliente_ads.panel_ads', nombre_nora=nombre_nora) }}?cuenta={{ cuenta.id_cuenta_publicitaria }}"
               class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded shadow transition text-sm">
              Ver Campañas
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="text-warning">⚠️ No hay cuentas publicitarias configuradas aún.</p>
    {% endif %}
  </section>

  <!-- Campañas Activas -->
  {% if campañas %}
  <section class="module">
    <h2>📈 Campañas para {{ cuenta_seleccionada.nombre_cliente }}</h2>
    <table class="tabla-contactos">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Estado</th>
          <th>Impresiones</th>
          <th>Clicks</th>
          <th>Alcance</th>
          <th>Gasto</th>
          <th>Objetivo</th>
        </tr>
      </thead>
      <tbody>
        {% for campana in campañas %}
        <tr>
          <td>{{ campana.name }}</td>
          <td>
            {% if campana.status == 'ACTIVE' %}
              🟢 Activa
            {% elif campana.status == 'PAUSED' %}
              🟡 Pausada
            {% elif campana.status == 'DISABLED' %}
              🔴 Cerrada
            {% else %}
              ⚠️ {{ campana.status }}
            {% endif %}
          </td>
          <td>{{ campana.insights.impressions if campana.insights }}</td>
          <td>{{ campana.insights.clicks if campana.insights }}</td>
          <td>{{ campana.insights.reach if campana.insights }}</td>
          <td>
            {{ campana.insights.spend if campana.insights }} {{ moneda }}
          </td>
          <td>{{ campana.insights.objective if campana.insights }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
  {% elif cuenta_seleccionada %}
  <section class="module">
    <h2>📈 Campañas para {{ cuenta_seleccionada.nombre_cliente }}</h2>
    <p>No hay campañas activas para esta cuenta.</p>
  </section>
  {% else %}
  <section class="module">
    <h2>📈 Campañas</h2>
    <p>Selecciona una cuenta publicitaria para ver sus campañas.</p>
  </section>
  {% endif %}

  <!-- Histórico de Reportes -->
  <section class="module">
    <h2>📄 Histórico de Reportes</h2>
    {% if reportes %}
    <ul class="list-group">
      {% for r in reportes %}
      <li class="list-group-item">
        <strong>{{ r.fecha_envio }}:</strong>
        <p>{{ r.mensaje }}</p>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-muted">No hay reportes enviados todavía.</p>
    {% endif %}
  </section>

</main>
{% endblock %}
