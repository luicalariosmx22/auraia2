<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Contactos – {{ nombre_visible or nombre_nora }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/panel_noras.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="meta-container">
    <header class="meta-header">
      <div>
        <h1>📇 Contactos – {{ nombre_visible or nombre_nora }}</h1>
      </div>
      <div>
        <a href="/logout" class="btn-outline">Cerrar sesión</a>
      </div>
    </header>

    {% with mensajes = get_flashed_messages() %}
      {% if mensajes %}
      <div class="flash" style="margin-bottom: 20px; background: #e0f4ff; padding: 12px; border-radius: 8px; color: #1877f2;">
        {{ mensajes[0] }}
      </div>
      {% endif %}
    {% endwith %}

    <section class="seccion">
      <h2>👥 Contactos registrados</h2>
      <table class="noras-table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Teléfono</th>
            <th>Etiquetas</th>
            {% if ia_permitida %}
              <th>IA</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for c in contactos %}
          <tr>
            <td>{{ c.nombre }}</td>
            <td>{{ c.numero }}</td>
            <td>
              {% if c.etiquetas %}
                {% for et in c.etiquetas %}
                  <span class="badge">{{ et }}</span>
                {% endfor %}
              {% else %}
                <span class="badge badge-muted">Sin etiquetas</span>
              {% endif %}
            </td>
            {% if ia_permitida %}
            <td>
              <form method="POST" action="/panel_cliente/contactos/{{ nombre_nora }}/toggle_ia">
                <input type="hidden" name="numero" value="{{ c.numero }}">
                {% if c.ia %}
                  <button type="submit" class="btn-outline">Desactivar IA</button>
                {% else %}
                  <button type="submit" class="btn-neutral">Activar IA</button>
                {% endif %}
              </form>
            </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <section class="seccion" style="margin-top: 40px;">
      <h3>➕ Agregar nuevo contacto</h3>
      <form method="POST" class="meta-card" style="max-width: 480px;">
        <input type="text" name="nombre" placeholder="Nombre completo" required class="input-text">
        <input type="text" name="telefono" placeholder="Número WhatsApp" required class="input-text">
        <input type="text" name="etiquetas" placeholder="Ej: cliente, vip, interesado" class="input-text">
        <button type="submit" class="btn-primary">💾 Guardar</button>
      </form>
    </section>

    <div style="margin-top: 40px;">
      <a href="{{ url_for('panel_cliente.panel_cliente', nombre_nora=nombre_nora) }}" class="btn-neutral">← Volver al panel</a>
    </div>
  </div>
</body>
</html>
