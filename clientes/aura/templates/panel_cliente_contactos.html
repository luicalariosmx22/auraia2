{% extends 'layout.html' %}

{% block contenido %}
<h2>📞 Contactos</h2>

<!-- 📍 FILTROS -->
<form action="/panel_cliente/contactos/{{ nombre_nora }}" method="get">
  <input type="text" name="busqueda" placeholder="Buscar por nombre o teléfono" value="{{ request.args.get('busqueda', '') }}">
  <input type="date" name="fecha_inicio" value="{{ request.args.get('fecha_inicio', '') }}">
  <input type="date" name="fecha_fin" value="{{ request.args.get('fecha_fin', '') }}">
  <select name="etiqueta">
    <option value="">Todas las etiquetas</option>
    {% for etiqueta in etiquetas %}
      <option value="{{ etiqueta }}" {% if request.args.get('etiqueta') == etiqueta %}selected{% endif %}>
        {{ etiqueta }}
      </option>
    {% endfor %}
  </select>
  <button type="submit">Filtrar</button>
</form>

<!-- 📍 FORMULARIO PARA AGREGAR CONTACTO -->
<form method="POST" action="/{{ nombre_nora }}/contactos/agregar" class="meta-card">
  <input type="text" name="telefono" placeholder="Teléfono" required>
  <input type="text" name="nombre" placeholder="Nombre" required>
  <input type="email" name="correo" placeholder="Correo">
  <input type="text" name="celular" placeholder="Celular">
  <input type="text" name="etiqueta" placeholder="Etiqueta">
  <button type="submit">Agregar Contacto</button>
</form>

<!-- 📍 LISTADO DE CONTACTOS -->
<form method="POST" action="/{{ nombre_nora }}/contactos/acciones">
  <table class="tabla-contactos">
    <thead>
      <tr>
        <th>✓</th>
        <th>Teléfono</th>
        <th>Nombre</th>
        <th>Correo</th>
        <th>Celular</th>
        <th>Etiquetas</th>
        <th>Último mensaje</th>
      </tr>
    </thead>
    <tbody>
      {% for c in contactos %}
        <tr>
          <td><input type="checkbox" name="contactos_seleccionados" value="{{ c.telefono }}"></td>
          <td>{{ c.telefono }}</td>
          <td>{{ c.nombre }}</td>
          <td>{{ c.correo or '' }}</td>
          <td>{{ c.celular or '' }}</td>
          <td>
            {% if c.etiquetas %}
              {{ c.etiquetas | join(', ') }}
            {% else %}
              Sin etiquetas
            {% endif %}
          </td>
          <td>{{ c.ultimo_mensaje[:10] if c.ultimo_mensaje }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <select name="accion" required>
    <option value="">Selecciona una acción</option>
    <option value="editar">Editar</option>
    <option value="eliminar">Eliminar</option>
  </select>
  <button type="submit">Aplicar</button>
</form>
{% endblock %}
