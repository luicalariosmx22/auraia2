{% extends 'layout.html' %}

{% block contenido %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/panel_cliente_contactos.css') }}">
<div class="meta-container">
  <h2>üìû Contactos</h2>

  <!-- üìç FILTROS -->
  <form action="/panel_cliente/contactos/{{ nombre_nora }}" method="get" class="meta-card">
    <h3>üîç Filtros</h3>
    <div class="form-group">
      <input type="text" name="busqueda" placeholder="Buscar por nombre o tel√©fono" value="{{ request.args.get('busqueda', '') }}">
      <input type="date" name="fecha_inicio" value="{{ request.args.get('fecha_inicio', '') }}">
      <input type="date" name="fecha_fin" value="{{ request.args.get('fecha_fin', '') }}">
      <select name="etiqueta">
        <option value="">Todas las etiquetas</option>
        {% for etiqueta in etiquetas %}
          <option value="{{ etiqueta }}" {% if request.args.get('etiqueta') == etiqueta %}selected{% endif %}>
            {{ etiqueta }}
          </option>
        {% endfor %}
      </select>
    </div>
    <button type="submit" class="btn-neutral">Filtrar</button>
  </form>

  <!-- üìç FORMULARIO PARA AGREGAR CONTACTO -->
  <form method="POST" action="/panel_cliente/contactos/{{ nombre_nora }}/agregar" class="meta-card">
    <h3>‚ûï Agregar Contacto</h3>
    <div class="form-group">
      <input type="text" name="telefono" placeholder="Tel√©fono" required>
      <input type="text" name="nombre" placeholder="Nombre" required>
      <input type="email" name="correo" placeholder="Correo">
      <input type="text" name="celular" placeholder="Celular">
      <input type="text" name="etiqueta" placeholder="Etiqueta">
    </div>
    <button type="submit" class="btn-neutral">Agregar Contacto</button>
  </form>

  <!-- üìç LISTADO DE CONTACTOS -->
  <form method="POST" action="/panel_cliente/contactos/{{ nombre_nora }}/acciones" class="meta-card">
    <h3>üìã Listado de Contactos</h3>
    <table class="tabla-contactos">
      <thead>
        <tr>
          <th>‚úì</th>
          <th>Tel√©fono</th>
          <th>Nombre</th>
          <th>Correo</th>
          <th>Celular</th>
          <th>Etiquetas</th>
          <th>√öltimo mensaje</th>
        </tr>
      </thead>
      <tbody>
        {% for c in contactos %}
        <tr>
          <td><input type="checkbox" name="contactos_seleccionados" value="{{ c.telefono }}"></td>
          <td>{{ c.telefono }}</td>
          <td>{{ c.nombre }}</td>
          <td>{{ c.correo or '' }}</td>
          <td>{{ c.celular or '' }}</td>
          <td>
            {% if c.etiquetas %}
              {{ c.etiquetas | join(', ') }}
            {% else %}
              Sin etiquetas
            {% endif %}
          </td>
          <td>{{ c.ultimo_mensaje[:10] if c.ultimo_mensaje }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="form-group">
      <select name="accion" required>
        <option value="">Selecciona una acci√≥n</option>
        <option value="editar">Editar</option>
        <option value="eliminar">Eliminar</option>
      </select>
      <button type="submit" class="btn-neutral">Aplicar</button>
    </div>
  </form>
</div>
{% endblock %}
