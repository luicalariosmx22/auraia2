<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Contactos - Nora AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
</head>
<body>
    <header>
        <div class="logo">üìá Contactos - Nora AI</div>
        <div class="logout"><a href="/logout">Cerrar sesi√≥n</a></div>
    </header>

    <main>
        <h2>Contactos registrados</h2>

        {% with mensajes = get_flashed_messages() %}
            {% if mensajes %}
                <div class="flash">{{ mensajes[0] }}</div>
            {% endif %}
        {% endwith %}

        <table class="noras-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Tel√©fono</th>
                    <th>Etiquetas</th>
                    {% if modulo_ia_activo %}
                        <th>IA</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for c in contactos %}
                <tr>
                    <td>{{ c.get("nombre", "Sin nombre") }}</td>
                    <td>{{ c.get("numero", "Sin n√∫mero") }}</td>
                    <td>
                        {% for et in c.get("etiquetas", []) %}
                            <span class="badge">{{ et }}</span>
                        {% else %}
                            <span class="badge">Sin etiquetas</span>
                        {% endfor %}
                    </td>
                    {% if modulo_ia_activo %}
                    <td>
                        <form method="POST" action="/panel_cliente/contactos/{{ nombre_nora }}/toggle_ia">
                            <input type="hidden" name="numero" value="{{ c.get('numero') }}">
                            {% if c.get("ia_activada") %}
                                <button type="submit" class="btn-desactivar">Desactivar IA</button>
                            {% else %}
                                <button type="submit" class="btn-activar">Activar IA</button>
                            {% endif %}
                        </form>
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h3>‚ûï Agregar nuevo contacto</h3>
        <form method="POST" class="form-contacto">
            <input type="text" name="nombre" placeholder="Nombre completo" required>
            <input type="text" name="numero" placeholder="N√∫mero WhatsApp" required>
            <input type="text" name="etiquetas" placeholder="Ej: cliente, vip, interesado">
            <button type="submit">üíæ Guardar</button>
        </form>

        <p><a href="/panel_cliente?forzar_cliente=1">‚Üê Volver al panel</a></p>
    </main>
</body>
</html>
