{% extends "base_cliente.html" %}

{% block contenido %}
<div class="container">
  <h2 class="text-2xl font-bold text-gray-800 mb-6">🏢 Empresas registradas</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <ul class="mb-6">
        {% for category, message in messages %}
          <li class="alert {% if category == 'success' %}alert-success{% elif category == 'error' %}alert-error{% endif %}">
            {{ message }}
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  {% if empresas %}
    {% for empresa in empresas %}
      <div class="card">
        <div class="flex justify-between items-center mb-2">
          <h3 class="text-lg font-semibold text-gray-800">{{ empresa.nombre_empresa }}</h3>
          {% if empresa.cliente %}
            <span class="text-sm text-green-600">👤 {{ empresa.cliente.nombre_cliente }}</span>
          {% else %}
            <span class="text-sm text-red-600">⚠️ Sin cliente vinculado</span>
          {% endif %}
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-gray-700 mb-2">
          {% if empresa.giro %}<p><strong>🧭 Giro:</strong> {{ empresa.giro }}</p>{% endif %}
          {% if empresa.telefono_empresa %}<p><strong>📞 Teléfono:</strong> {{ empresa.telefono_empresa }}</p>{% endif %}
          {% if empresa.email_empresa %}<p><strong>✉️ Email:</strong> {{ empresa.email_empresa }}</p>{% endif %}
          {% if empresa.ciudad %}<p><strong>🏙️ Ciudad:</strong> {{ empresa.ciudad }}</p>{% endif %}
        </div>

        <div class="flex gap-4 mt-3 text-sm">
          <a href="{{ empresa.url_editar }}" class="text-blue-600 hover:underline">✏️ Editar</a>
          {% if not empresa.cliente %}
            <a href="{{ empresa.url_ligar }}" class="text-blue-600 hover:underline">➕ Ligar cliente</a>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="bg-white text-center shadow-md border border-gray-200 rounded-xl p-10 mt-12">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">🫥 Aún no tienes empresas registradas</h3>
      <p class="text-gray-600 text-sm mb-6">Agrega tu primera empresa para comenzar a vincular clientes y gestionar pagos.</p>
      <a href="{{ url_for('panel_cliente_clientes_bp.nueva_empresa', nombre_nora=nombre_nora) }}"
         class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition">
        ➕ Crear nueva empresa
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
